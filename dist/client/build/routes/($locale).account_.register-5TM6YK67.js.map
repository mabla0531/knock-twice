{
  "version": 3,
  "sources": ["../../../../app/routes/($locale).account_.register.jsx"],
  "sourcesContent": ["// REMIX HMR BEGIN\nif (!window.$RefreshReg$ || !window.$RefreshSig$ || !window.$RefreshRuntime$) {\n  console.warn('remix:hmr: React Fast Refresh only works when the Remix compiler is running in development mode.');\n} else {\n  var prevRefreshReg = window.$RefreshReg$;\n  var prevRefreshSig = window.$RefreshSig$;\n  window.$RefreshReg$ = (type, id) => {\n    window.$RefreshRuntime$.register(type, \"\\\"app\\\\\\\\routes\\\\\\\\($locale).account_.register.jsx\\\"\" + id);\n  }\n  window.$RefreshSig$ = window.$RefreshRuntime$.createSignatureFunctionForTransform;\n}\nvar _s = $RefreshSig$();\nimport * as __hmr__ from \"remix:hmr\";\nif (import.meta) {\n  import.meta.hot = __hmr__.createHotContext(\n  //@ts-expect-error\n  \"app\\\\routes\\\\($locale).account_.register.jsx\");\n  import.meta.hot.lastModified = \"1700954361044.3948\";\n}\n// REMIX HMR END\n\nimport { json, redirect } from '@shopify/remix-oxygen';\nimport { Form, Link, useActionData } from '@remix-run/react';\n\n/**\n * @param {LoaderFunctionArgs}\n */\nexport async function loader({\n  context\n}) {\n  const customerAccessToken = await context.session.get('customerAccessToken');\n  if (customerAccessToken) {\n    return redirect('/account');\n  }\n  return json({});\n}\n\n/**\n * @param {ActionFunctionArgs}\n */\nexport async function action({\n  request,\n  context\n}) {\n  if (request.method !== 'POST') {\n    return json({\n      error: 'Method not allowed'\n    }, {\n      status: 405\n    });\n  }\n  const {\n    storefront,\n    session\n  } = context;\n  const form = await request.formData();\n  const email = String(form.has('email') ? form.get('email') : '');\n  const password = form.has('password') ? String(form.get('password')) : null;\n  const passwordConfirm = form.has('passwordConfirm') ? String(form.get('passwordConfirm')) : null;\n  const validPasswords = password && passwordConfirm && password === passwordConfirm;\n  const validInputs = Boolean(email && password);\n  try {\n    if (!validPasswords) {\n      throw new Error('Passwords do not match');\n    }\n    if (!validInputs) {\n      throw new Error('Please provide both an email and a password.');\n    }\n    const {\n      customerCreate\n    } = await storefront.mutate(CUSTOMER_CREATE_MUTATION, {\n      variables: {\n        input: {\n          email,\n          password\n        }\n      }\n    });\n    if (customerCreate?.customerUserErrors?.length) {\n      throw new Error(customerCreate?.customerUserErrors[0].message);\n    }\n    const newCustomer = customerCreate?.customer;\n    if (!newCustomer?.id) {\n      throw new Error('Could not create customer');\n    }\n\n    // get an access token for the new customer\n    const {\n      customerAccessTokenCreate\n    } = await storefront.mutate(REGISTER_LOGIN_MUTATION, {\n      variables: {\n        input: {\n          email,\n          password\n        }\n      }\n    });\n    if (!customerAccessTokenCreate?.customerAccessToken?.accessToken) {\n      throw new Error('Missing access token');\n    }\n    session.set('customerAccessToken', customerAccessTokenCreate?.customerAccessToken);\n    return json({\n      error: null,\n      newCustomer\n    }, {\n      status: 302,\n      headers: {\n        'Set-Cookie': await session.commit(),\n        Location: '/account'\n      }\n    });\n  } catch (error) {\n    if (error instanceof Error) {\n      return json({\n        error: error.message\n      }, {\n        status: 400\n      });\n    }\n    return json({\n      error\n    }, {\n      status: 400\n    });\n  }\n}\nexport default function Register() {\n  _s();\n  /** @type {ActionReturnData} */\n  const data = useActionData();\n  const error = data?.error || null;\n  return <div className=\"login\">\n      <h1>Register.</h1>\n      <Form method=\"POST\">\n        <fieldset>\n          <label htmlFor=\"email\">Email address</label>\n          <input id=\"email\" name=\"email\" type=\"email\" autoComplete=\"email\" required placeholder=\"Email address\" aria-label=\"Email address\"\n        // eslint-disable-next-line jsx-a11y/no-autofocus\n        autoFocus />\n          <label htmlFor=\"password\">Password</label>\n          <input id=\"password\" name=\"password\" type=\"password\" autoComplete=\"current-password\" placeholder=\"Password\" aria-label=\"Password\" minLength={8} required />\n          <label htmlFor=\"passwordConfirm\">Re-enter password</label>\n          <input id=\"passwordConfirm\" name=\"passwordConfirm\" type=\"password\" autoComplete=\"current-password\" placeholder=\"Re-enter password\" aria-label=\"Re-enter password\" minLength={8} required />\n        </fieldset>\n        {error ? <p>\n            <mark>\n              <small>{error}</small>\n            </mark>\n          </p> : <br />}\n        <button type=\"submit\">Register</button>\n      </Form>\n      <br />\n      <p>\n        <Link to=\"/account/login\">Login \u2192</Link>\n      </p>\n    </div>;\n}\n\n// NOTE: https://shopify.dev/docs/api/storefront/latest/mutations/customerCreate\n_s(Register, \"EuQJlwp+1/dClAy+OhUaWQ2c6r8=\", false, function () {\n  return [useActionData];\n});\n_c = Register;\nconst CUSTOMER_CREATE_MUTATION = `#graphql\n  mutation customerCreate(\n    $input: CustomerCreateInput!,\n    $country: CountryCode,\n    $language: LanguageCode\n  ) @inContext(country: $country, language: $language) {\n    customerCreate(input: $input) {\n      customer {\n        id\n      }\n      customerUserErrors {\n        code\n        field\n        message\n      }\n    }\n  }\n`;\n\n// NOTE: https://shopify.dev/docs/api/storefront/latest/mutations/customeraccesstokencreate\nconst REGISTER_LOGIN_MUTATION = `#graphql\n  mutation registerLogin(\n    $input: CustomerAccessTokenCreateInput!,\n    $country: CountryCode,\n    $language: LanguageCode\n  ) @inContext(country: $country, language: $language) {\n    customerAccessTokenCreate(input: $input) {\n      customerUserErrors {\n        code\n        field\n        message\n      }\n      customerAccessToken {\n        accessToken\n        expiresAt\n      }\n    }\n  }\n`;\n\n/**\n * @typedef {{\n *   error: string | null;\n *   newCustomer:\n *     | NonNullable<CustomerCreateMutation['customerCreate']>['customer']\n *     | null;\n * }} ActionResponse\n */\n\n/** @typedef {import('@shopify/remix-oxygen').ActionFunctionArgs} ActionFunctionArgs */\n/** @typedef {import('@shopify/remix-oxygen').LoaderFunctionArgs} LoaderFunctionArgs */\n/** @typedef {import('storefrontapi.generated').CustomerCreateMutation} CustomerCreateMutation */\n/** @typedef {import('@shopify/remix-oxygen').SerializeFrom<typeof loader>} LoaderReturnData */\n/** @typedef {import('@shopify/remix-oxygen').SerializeFrom<typeof action>} ActionReturnData */\nvar _c;\n$RefreshReg$(_c, \"Register\");\n\nwindow.$RefreshReg$ = prevRefreshReg;\nwindow.$RefreshSig$ = prevRefreshSig;"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAoIM;AAnIN,IAAI,CAAC,OAAO,gBAAgB,CAAC,OAAO,gBAAgB,CAAC,OAAO,kBAAkB;AAC5E,UAAQ,KAAK,kGAAkG;AACjH,OAAO;AACD,mBAAiB,OAAO;AACxB,mBAAiB,OAAO;AAC5B,SAAO,eAAe,CAAC,MAAM,OAAO;AAClC,WAAO,iBAAiB,SAAS,MAAM,uDAAyD,EAAE;AAAA,EACpG;AACA,SAAO,eAAe,OAAO,iBAAiB;AAChD;AANM;AACA;AAMN,IAAI,KAAK,aAAa;AAEtB,IAAI,aAAa;AACf,cAAY,MAAc;AAAA;AAAA,IAE1B;AAAA,EAA8C;AAC9C,cAAY,IAAI,eAAe;AACjC;AA4Ge,SAAR,WAA4B;AACjC,KAAG;AAEH,QAAM,OAAO,cAAc;AAC3B,QAAM,QAAQ,MAAM,SAAS;AAC7B,SAAO,mDAAC,SAAI,WAAU,SAClB;AAAA,uDAAC,QAAG,yBAAJ;AAAA;AAAA;AAAA;AAAA,WAAa;AAAA,IACb,mDAAC,QAAK,QAAO,QACX;AAAA,yDAAC,cACC;AAAA,2DAAC,WAAM,SAAQ,SAAQ,6BAAvB;AAAA;AAAA;AAAA;AAAA,eAAoC;AAAA,QACpC;AAAA,UAAC;AAAA;AAAA,YAAM,IAAG;AAAA,YAAQ,MAAK;AAAA,YAAQ,MAAK;AAAA,YAAQ,cAAa;AAAA,YAAQ,UAAQ;AAAA,YAAC,aAAY;AAAA,YAAgB,cAAW;AAAA,YAEnH,WAAS;AAAA;AAAA,UAFP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAEQ;AAAA,QACR,mDAAC,WAAM,SAAQ,YAAW,wBAA1B;AAAA;AAAA;AAAA;AAAA,eAAkC;AAAA,QAClC,mDAAC,WAAM,IAAG,YAAW,MAAK,YAAW,MAAK,YAAW,cAAa,oBAAmB,aAAY,YAAW,cAAW,YAAW,WAAW,GAAG,UAAQ,QAAxJ;AAAA;AAAA;AAAA;AAAA,eAAyJ;AAAA,QACzJ,mDAAC,WAAM,SAAQ,mBAAkB,iCAAjC;AAAA;AAAA;AAAA;AAAA,eAAkD;AAAA,QAClD,mDAAC,WAAM,IAAG,mBAAkB,MAAK,mBAAkB,MAAK,YAAW,cAAa,oBAAmB,aAAY,qBAAoB,cAAW,qBAAoB,WAAW,GAAG,UAAQ,QAAxL;AAAA;AAAA;AAAA;AAAA,eAAyL;AAAA,WAR3L;AAAA;AAAA;AAAA;AAAA,aASA;AAAA,MACC,QAAQ,mDAAC,OACN,6DAAC,UACC,6DAAC,WAAO,mBAAR;AAAA;AAAA;AAAA;AAAA,aAAc,KADhB;AAAA;AAAA;AAAA;AAAA,aAEA,KAHK;AAAA;AAAA;AAAA;AAAA,aAIP,IAAO,mDAAC,UAAD;AAAA;AAAA;AAAA;AAAA,aAAI;AAAA,MACb,mDAAC,YAAO,MAAK,UAAS,wBAAtB;AAAA;AAAA;AAAA;AAAA,aAA8B;AAAA,SAhBhC;AAAA;AAAA;AAAA;AAAA,WAiBA;AAAA,IACA,mDAAC,UAAD;AAAA;AAAA;AAAA;AAAA,WAAI;AAAA,IACJ,mDAAC,OACC,6DAAC,QAAK,IAAG,kBAAiB,4BAA1B;AAAA;AAAA;AAAA;AAAA,WAAiC,KADnC;AAAA;AAAA;AAAA;AAAA,WAEA;AAAA,OAvBG;AAAA;AAAA;AAAA;AAAA,SAwBL;AACJ;AAGA,GAAG,UAAU,gCAAgC,OAAO,WAAY;AAC9D,SAAO,CAAC,aAAa;AACvB,CAAC;AACD,KAAK;AAuDL,IAAI;AACJ,aAAa,IAAI,UAAU;AAE3B,OAAO,eAAe;AACtB,OAAO,eAAe;",
  "names": []
}
